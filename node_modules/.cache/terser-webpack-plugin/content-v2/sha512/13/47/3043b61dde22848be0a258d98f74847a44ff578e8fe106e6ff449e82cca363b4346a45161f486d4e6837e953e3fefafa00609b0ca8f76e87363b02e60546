{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{504:function(t,a,e){\"use strict\";e.r(a);var r=e(4),s=Object(r.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[e(\"h2\",{attrs:{id:\"_1-はじめに\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-はじめに\"}},[t._v(\"#\")]),t._v(\" 1. はじめに\")]),t._v(\" \"),e(\"p\",[t._v(\"はい｡こちらの Tweet...にも書いてあるとおり､誤って作業鯖を消してしまいました｡\")]),t._v(\" \"),e(\"blockquote\",{staticClass:\"twitter-tweet\"},[e(\"p\",{attrs:{lang:\"ja\",dir:\"ltr\"}},[t._v(\"停止と終了を誤って､インスタンスを一台消してしまった････\"),e(\"br\"),t._v(\"やってしまった･･･\")]),t._v(\"— まるちゃんLv24@DevOps (@M_Maru76) \"),e(\"a\",{attrs:{href:\"https://twitter.com/M_Maru76/status/1336130931338309634?ref_src=twsrc%5Etfw\"}},[t._v(\"December 8, 2020\")])]),t._v(\" \"),e(\"script\",{attrs:{async:\"\",src:\"https://platform.twitter.com/widgets.js\",charset:\"utf-8\"}}),t._v(\" \"),e(\"p\",[t._v(\"反省するために､ EC2 インスタンスに対してターミネートブロックの手順を書いていきます｡\")]),t._v(\" \"),e(\"p\",[e(\"s\",[t._v(\"(ちなみに､発覚した後は､一日中ずっっっっっっっと胃が痛かったです｡)\")])]),t._v(\" \"),e(\"h2\",{attrs:{id:\"_2-終了保護-termination-protection-とは\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-終了保護-termination-protection-とは\"}},[t._v(\"#\")]),t._v(\" 2. 終了保護(Termination protection)とは\")]),t._v(\" \"),e(\"p\",[e(\"code\",[t._v(\"DisableApiTermination\")]),t._v(\" 属性の有効/無効を定義するものです｡\\n有効になっている場合は､【API(マネジメントコンソール/CLI/API)】等によるインスタンスの終了(削除)を防止することが出来ます｡\")]),t._v(\" \"),e(\"ul\",[e(\"li\",[t._v(\"デフォルトでは\"),e(\"code\",[t._v(\"無効\")]),t._v(\"になっています｡\")])]),t._v(\" \"),e(\"p\",[t._v(\"終了保護が有効なインスタンスを新マネジメントコンソールから削除しようとした時は下記画像のヘッダーのようにエラーが表示されます｡\")]),t._v(\" \"),e(\"p\",[e(\"a\",{attrs:{href:\"https://gyazo.com/e41cec9a03ddb839f67358455693be3e\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e(\"img\",{attrs:{src:\"https://i.gyazo.com/e41cec9a03ddb839f67358455693be3e.png\",alt:\"Image from Gyazo\"}}),e(\"OutboundLink\")],1)]),t._v(\" \"),e(\"p\",[t._v(\"終了保護が有効なインスタンスを CLI で削除を\\bしようとすると下記のエラーが表示されます｡\")]),t._v(\" \"),e(\"div\",{staticClass:\"language-sh line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-sh\"}},[e(\"code\",[t._v(\"▶ aws ec2 terminate-instances --instance-ids i-0e4167cd354860fbd\\n\\nAn error occurred \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"OperationNotPermitted\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" when calling the TerminateInstances operation: \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"\\\\\")]),t._v(\"\\nThe instance \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'i-0e4167cd354860fbd'\")]),t._v(\" may not be terminated. \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"\\\\\")]),t._v(\"\\nModify its \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'disableApiTermination'\")]),t._v(\" instance attribute and try again.\\n\")])]),t._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[t._v(\"3\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[t._v(\"4\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[t._v(\"5\")]),e(\"br\")])]),e(\"p\",[t._v(\"ただ･･･インスタンスの削除を完全に回避できる!!という訳ではなく､ API による削除以外の､下記の場合は削除される模様です｡\")]),t._v(\" \"),e(\"ul\",[e(\"li\",[t._v(\"シャットダウン動作による削除\")]),t._v(\" \"),e(\"li\",[t._v(\"Auto Scaling グループによる削除\")])]),t._v(\" \"),e(\"div\",{staticClass:\"custom-block tip\"},[e(\"p\",[t._v(\"詳しくはAWSドキュメント ｢終了保護の有効化｣\")]),t._v(\" \"),e(\"ul\",[e(\"li\",[e(\"a\",{attrs:{href:\"http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/terminating-instances.html#Using_ChangingDisableAPITermination\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"インスタンスの終了保護の有効化\"),e(\"OutboundLink\")],1)])])]),t._v(\" \"),e(\"h2\",{attrs:{id:\"_3-終了保護の設定手順\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-終了保護の設定手順\"}},[t._v(\"#\")]),t._v(\" 3. 終了保護の設定手順\")]),t._v(\" \"),e(\"ol\",[e(\"li\",[t._v(\"終了保護を掛けたいインスタンスを選択\")]),t._v(\" \"),e(\"li\",[t._v(\"【アクション】→【インスタンスの設定】→【終了保護を変更】を選択\\n\"),e(\"ul\",[e(\"li\",[e(\"a\",{attrs:{href:\"https://gyazo.com/b8a27c3a85765ed09a119ba35f4d67ef\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e(\"img\",{attrs:{src:\"https://i.gyazo.com/b8a27c3a85765ed09a119ba35f4d67ef.png\",alt:\"Image from Gyazo\"}}),e(\"OutboundLink\")],1)])])]),t._v(\" \"),e(\"li\",[t._v(\"終了保護の【有効化】にチェックを入れて保存\\n\"),e(\"ul\",[e(\"li\",[e(\"a\",{attrs:{href:\"https://gyazo.com/0a817d708f80a81328257cd6e64b0967\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e(\"img\",{attrs:{src:\"https://i.gyazo.com/0a817d708f80a81328257cd6e64b0967.gif\",alt:\"Image from Gyazo\"}}),e(\"OutboundLink\")],1)])])])]),t._v(\" \"),e(\"p\",[t._v(\"これで終了保護が完了致しました｡\")]),t._v(\" \"),e(\"p\",[t._v(\"試しにマネコンで終了させてみたり､停止後に終了させてみると下記画像のヘッダーみたいに赤いバーで怒られます｡\")]),t._v(\" \"),e(\"p\",[e(\"a\",{attrs:{href:\"https://gyazo.com/ef0f70d5294281b7474f43cdc8fc0b57\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e(\"img\",{attrs:{src:\"https://i.gyazo.com/ef0f70d5294281b7474f43cdc8fc0b57.png\",alt:\"Image from Gyazo\"}}),e(\"OutboundLink\")],1)]),t._v(\" \"),e(\"h2\",{attrs:{id:\"_4-さいごに\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4-さいごに\"}},[t._v(\"#\")]),t._v(\" 4. さいごに\")]),t._v(\" \"),e(\"p\",[t._v(\"本当に､申し訳ない事をしてしまった･･･そしてガチで動いているサービスじゃなくて良かった｡\")]),t._v(\" \"),e(\"p\",[t._v(\"そして､削除なのか､終了なのか｡統一して欲しい｡\"),e(\"br\"),t._v(\"(いっそのこと Terminate で良いと思う)\")])])}),[],!1,null,null,null);a.default=s.exports}}]);","extractedComments":[]}